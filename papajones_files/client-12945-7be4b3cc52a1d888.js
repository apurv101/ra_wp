"use strict";(self.webpackChunkFusion=self.webpackChunkFusion||[]).push([[12945],{92005:(e,s,t)=>{t.d(s,{Z:()=>a});var n=t(58984),l=t(15070),i=t(58730),r=t(59400),o=t(70605);function a(){const e=(0,n.I0)(),{selectedVoucherUUID:s}=(0,l.v)((e=>{let{checkout:s}=e;return s}))||{},{data:t}=(0,i.t)(),{vouchers:a}=t||{};return function(e,s){const t=(0,r.ab)(e);if(e&&t)return{voucherData:e,voucherUUID:e?.uuid};e&&!t&&s();return{voucherData:null,voucherUUID:null}}(s&&a?a[s]:null,(()=>e((0,o.rj)())))}},12945:(e,s,t)=>{t.d(s,{Pk:()=>Z,ZP:()=>M,IM:()=>b});var n=t(36151),l=t(69744),i=t(58984),r=t(15070),o=t(88631),a=t(95761),u=t(70605),d=t(34626),c=t(21117);var P=t(84939),p=t(67023),f=t(91631),y=t(83960),m=t(66316),B=t(62149),h=t(47986),U=t(92005),S=t(93008),C=t(81436),I=t(70247),E=t(35446);const x=(e,s)=>({profileUUID:e?.uuid,profileType:e?.type,policyUUID:s?.uuid,policyVersion:s?.version});const D=e=>{const{user:s}=(0,d.Z)(),t=(0,i.I0)(),{vouchersData:l}=(0,p.Z)(),{businessPolicies:D,policies:O,businessProfiles:g,getBusinessProfiles:Z,onSelectBusinessProfile:b,selectedBusinessProfile:M,selectedBusinessPolicy:T,businessExpenseCodes:v,searchBusinessExpenseCodes:F,selectedBusinessExpenseCode:k,setSelectedBusinessExpenseCode:L,getBackUrl:H,handleBusinessBackButton:A,selectedBusinessExpenseMemo:V,setSelectedBusinessExpenseMemo:_,setSelectedBusinessPolicy:N,requiresProfileFlow:G,currentStep:w,getInitialUrl:R,confirmedProfileSelected:Y,setConfirmedProfileSelected:q,getBusinessDetails:z,hasBusinessProfile:K,isOrgManagedUser:W}=(0,c.Z)(),{draftOrder:$}=(0,I.Dz)(),{selectedPersonalPayment:j,selectedMembershipPayment:J,extraPaymentData:Q,paymentProfiles:X,creditBalances:ee,useCredits:se,updateSelectedPersonalPayment:te,guestPaymentProfile:ne,setGuestPaymentProfile:le,guestPaymentProfileV2:ie,setGuestPaymentProfileV2:re,useHealthcareBenefits:oe,updateSelectedMembershipPayment:ae,getCreditBalances:ue}=(0,P.Z)({businessProfiles:g,draftOrder:$}),de=(0,r.v)((e=>e.checkout))||{},{selectedVoucherUUID:ce,selectedBusinessPayment:Pe}=de,[pe,fe]=function(e){let{initialPaymentIntent:s}=e;const[t,l]=(0,n.useState)(s);return[t,l]}({initialPaymentIntent:"personal"}),[ye,me]=n.useState(null),[Be,he]=n.useState(null);function Ue(e){if(fe(e),"business"===e||$?.billSplitOption===E.xp.SPLIT_BY_SUBTOTAL)return;const s=ce&&(l?.data?.vouchers||{})[ce];s&&t((0,u.wL)(s))}const{setSelectedBusinessExpenseCode:Se,setSelectedBusinessExpenseMemo:Ce,isValidPaymentSwitch:Ie,updateDraftOrderPaymentProfile:Ee,updateDraftOrderError:xe,setUseCreditsForManagedBusiness:De}=function(e){const s=(0,f.k6)(),t=(0,B.TH)(),l=(0,i.I0)(),r=(0,U.Z)(),{draftOrderUUID:u,draftOrder:d}=(0,I.Dz)(),{hasGroupOrder:c}=(0,y.Z)(),{updateDraftOrderV2:P,updateDraftOrderMaybe:p}=(0,m.Z)(),[D,O]=(0,n.useState)(!1),[g,Z]=(0,n.useState)(!1),b=Boolean(u),{groupOrder:M,getGroupOrder:T,shouldGetGroupOrder:v}=(0,S.Z)(u||"");(0,C.Z)((()=>v&&e.paymentIntent?T():null),[T,v,e],"use-business-draft-order");const F=(0,n.useCallback)((s=>{if(b&&!p.isLoading){const t=x(e.selectedBusinessProfile,e.selectedBusinessPolicy);P({draftOrderUUID:u||"",businessDetails:{...t,expenseCode:s?.expenseCode}})}e.setSelectedBusinessExpenseCodeFn(s)}),[e,b,u,P,p]),k=(0,n.useCallback)((s=>{if(b&&!p.isLoading){const t=x(e.selectedBusinessProfile,e.selectedBusinessPolicy);P({draftOrderUUID:u||"",businessDetails:{...t,expenseCode:e.selectedBusinessExpenseCode?.expenseCode,expenseMemo:s}})}e.setSelectedBusinessExpenseMemoFn(s)}),[e,b,u,P,p]),L=(0,n.useCallback)((s=>{if(!b||!M.data)return null;O(!1),!s||s.profileType!==o.Hu.Business&&s.profileType!==o.Hu.ManagedFamily||(delete s.voucherPolicyVersion,delete s.voucherUUID),s&&s.profileType===o.Hu.Personal&&d?.billSplitOption!==E.xp.SPLIT_BY_SUBTOTAL&&r?.voucherUUID&&(s.voucherPolicyVersion=r?.voucherData?.policy?.version,s.voucherUUID=r?.voucherUUID),l((0,a.GA)(s)),s?.profileType===o.Hu.Personal&&e.selectedBusinessPolicy?.isExpenseCodeRequired&&(e.setSelectedBusinessExpenseCodeFn(null),e.setSelectedBusinessExpenseMemoFn(null))}),[b,M.data,r,u,l,P,e.selectedBusinessProfile,e.selectedBusinessPolicy,e.selectedPersonalPayment]);return(0,n.useEffect)((()=>{if(M.data&&("business"===e.paymentIntent&&e.selectedBusinessPolicy||e.selectedPersonalPayment?.type===o.Hu.ManagedFamily)&&b){const s={profileUUID:e.selectedBusinessProfile?.uuid,profileType:e.selectedBusinessProfile?.type,policyUUID:e.selectedBusinessPolicy?.uuid,policyVersion:e.selectedBusinessPolicy?.version};if(O(!1),e.selectedPersonalPayment?.type===o.Hu.ManagedFamily&&"personal"===e.paymentIntent){const t=e?.policies?.find((s=>s.employeeUUID===e?.selectedPersonalPayment?.entityUuid)),n=t?.policies?.[0];s.profileUUID=e.selectedPersonalPayment.uuid,s.profileType=o.Hu.ManagedFamily,s.policyUUID=n?.uuid,s.policyVersion=null,l((0,a.Nc)(e.selectedPersonalPayment?.defaultPaymentProfileUuid))}l((0,a.GA)(s)),l((0,a.eL)(g)),s?.profileType!==o.Hu.Personal&&s?.profileType!==o.Hu.ManagedFamily&&(l((0,a.Nc)(e.selectedBusinessProfile?.defaultPaymentProfileUuid)),l((0,a.ZF)([])))}}),[M,u,P,e.paymentIntent,e.selectedBusinessPolicy,e.selectedBusinessProfile,e.selectedPersonalPayment,e.policies,b,O,c,l,g]),(0,n.useEffect)((()=>{const e=(0,h.vN_)(t,"updateDraftOrderError");!D&&p.hasLoaded&&p.error&&(O(!0),s.replace(e))}),[p,O,D,s,t]),(0,n.useEffect)((()=>{!D&&t?.search!==(0,h.vN_)(t,"updateDraftOrderError")?.search||!p.hasLoaded||p.error||(O(!1),s.replace((0,h.Zs0)(t)))}),[p,O,D,s,t]),{setSelectedBusinessExpenseCode:F,setSelectedBusinessExpenseMemo:k,isValidPaymentSwitch:e=>e===o.Hu.Personal||e===o.Hu.Business,updateDraftOrderPaymentProfile:L,setUseCreditsForManagedBusiness:Z,updateDraftOrderError:p.error}}({selectedBusinessPayment:Pe,policies:O,selectedBusinessProfile:M,selectedBusinessPolicy:T,selectedBusinessExpenseCode:k,selectedBusinessExpenseMemo:V,setSelectedBusinessExpenseCodeFn:L,setSelectedBusinessExpenseMemoFn:_,setPaymentIntent:Ue,paymentIntent:pe,businessProfiles:g,selectedPersonalPayment:j});return e.children({businessPolicies:D,businessProfiles:g,getBusinessProfiles:Z,onSelectBusinessProfile:b,selectedBusinessProfile:M,selectedBusinessPolicy:T,setSelectedBusinessPolicy:N,businessExpenseCodes:v,searchBusinessExpenseCodes:F,selectedBusinessExpenseCode:k,setSelectedBusinessExpenseCode:Se,getBackUrl:H,handleBusinessBackButton:A,selectedBusinessExpenseMemo:V,setSelectedBusinessExpenseMemo:Ce,requiresProfileFlow:G,selectedBusinessPayment:Pe,currentStep:w,hasBusinessProfile:K,isOrgManagedUser:W,selectedPersonalPayment:j,selectedMembershipPayment:J,extraPaymentData:Q,paymentProfiles:X,creditBalances:ee,paymentIntent:pe,setPaymentIntent:Ue,getInitialUrl:R,confirmedProfileSelected:Y,setConfirmedProfileSelected:q,useCredits:se??(ee.length>0&&!$?.extraPaymentProfiles?.length),user:s,updateSelectedPersonalPayment:te,updateSelectedMembershipPayment:ae,updateSelectedBusinessPayment:e=>{N(null),t((0,u.Kz)(e)),e?.profileType===o.Hu.Business&&t((0,a.Nc)(e?.paymentProfileUuid))},updateExtraPaymentData:e=>{t((0,u.n2)(e))},updateUseCredits:(e,s)=>{s!==o.Hu.Personal&&s?s===o.Hu.Business?t((0,u.sg)(e)):De(e):t((0,u.Pe)(e))},updateCreditBalances:()=>{ue&&ue()},isValidPaymentSwitch:Ie,getBusinessDetails:z,updateDraftOrderPaymentProfile:Ee,updateDraftOrderError:xe,guestPaymentProfile:ne,setGuestPaymentProfile:le,guestPaymentProfileV2:ie,setGuestPaymentProfileV2:re,paymentProfileInfoForCheckoutActions:ye,setPaymentProfileInfoForCheckoutActions:me,estimatedPaymentPlanForCheckoutActions:Be,setEstimatedPaymentPlanForCheckoutActions:he,useHealthcareBenefits:oe,updateUseHealthcareBenefits:(e,s)=>{s===o.Hu.Personal?t((0,u.R$)(e)):(o.Hu.Business,t((0,u.R$)(!1)))}})};var O=t(51048),g=t(33990);const Z=n.createContext({businessPolicies:o.TW,businessProfiles:null,getBusinessProfiles:l.Z,selectedBusinessProfile:null,selectedBusinessPolicy:null,setSelectedBusinessPolicy:l.Z,onSelectBusinessProfile:l.Z,businessExpenseCodes:o.$C,searchBusinessExpenseCodes:()=>{},selectedBusinessExpenseCode:null,setSelectedBusinessExpenseCode:l.Z,selectedBusinessExpenseMemo:null,setSelectedBusinessExpenseMemo:l.Z,getBackUrl:()=>({}),handleBusinessBackButton:l.Z,requiresProfileFlow:()=>!1,creditBalances:[],extraPaymentData:null,paymentProfiles:[],updateExtraPaymentData:l.Z,updateSelectedBusinessPayment:l.Z,updateUseCredits:l.Z,useCredits:!1,user:O.V,paymentIntent:"personal",setPaymentIntent:l.Z,updateSelectedPersonalPayment:l.Z,updateSelectedMembershipPayment:l.Z,selectedPersonalPayment:null,selectedBusinessPayment:null,selectedMembershipPayment:null,currentStep:"PROFILE",getInitialUrl:()=>({}),confirmedProfileSelected:!1,setConfirmedProfileSelected:l.Z,isValidPaymentSwitch:()=>!1,isOrgManagedUser:void 0,getBusinessDetails:()=>({profileUUID:null,profileType:null,policyUUID:null,policyVersion:null}),updateDraftOrderPaymentProfile:()=>null,updateDraftOrderError:null,hasBusinessProfile:!1,guestPaymentProfile:null,setGuestPaymentProfile:l.Z,guestPaymentProfileV2:null,setGuestPaymentProfileV2:l.Z,paymentProfileInfoForCheckoutActions:null,setPaymentProfileInfoForCheckoutActions:l.Z,estimatedPaymentPlanForCheckoutActions:null,setEstimatedPaymentPlanForCheckoutActions:l.Z,useHealthcareBenefits:!1,updateUseHealthcareBenefits:l.Z,updateCreditBalances:()=>null}),b=()=>{const e=n.useContext(Z);if(null!==e)return e;throw Error("You should use useEditPaymentProfilesContext only in a descendant of EditPaymentProfilesProvider")};function M(e){return(0,g.tZ)(D,{children:s=>(0,g.tZ)(Z.Provider,{value:s,children:e.children})})}},35446:(e,s,t)=>{t.d(s,{xp:()=>n});const n={UNKNOWN_BILL_SPLIT_OPTION:"UNKNOWN_BILL_SPLIT_OPTION",CREATOR_PAYS_ALL:"CREATOR_PAYS_ALL",SPLIT_BY_SUBTOTAL:"SPLIT_BY_SUBTOTAL"}}}]);