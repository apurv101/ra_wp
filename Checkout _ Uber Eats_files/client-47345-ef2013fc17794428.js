"use strict";(self.webpackChunkFusion=self.webpackChunkFusion||[]).push([[47345],{__fusion__27:(t,e,i)=>{i.r(e),i.d(e,{default:()=>D});var s=i(20196),u=i(94097),n=i(36151),o=i(91631),a=i(72843),r=i(47986),c=i(86080),m=i(98976),d=i(1795),l=i(93801),I=i(40606),p=i(62149),U=i(75161),f=i(56899),y=i(53614),C=i(33990);const Z=t=>{const e=(0,p.TH)(),i=(0,o.k6)(),s=(0,n.useContext)(y.v),{customizationRefUuids:u=[]}=(0,r.vRw)(),Z=(0,r.C45)(e),h="quickView"===a.parse(e?.search)?.mod;return(0,C.tZ)(U.u_,{onClose:()=>{if(!s)return i.push(Z);let t=parseInt(u.length/2);h&&t++,i.go(-1*t)},isOpen:!0,size:f.NO.auto,children:(0,C.tZ)(I.Z,{source:(0,m.FP)(t.store,t.menuItem),loaded:e=>{let[i,s]=e;return(0,C.tZ)(c.Z,{store:i,item:s,rootLevelCustomizations:t.initialCustomizations,isOnSale:t.isOnSale,saveCustomizations:t.saveCustomizations,quantity:t.quantity,customizationRefUuids:u})},error:t=>{let{code:e}=t;return(0,C.tZ)(l.Qv,{code:e})},loading:()=>(0,C.tZ)(d.Z,{})})})};var h=i(24857),v=i("__fusion__22"),b=i(8420),O=i(58984),S=i(70247),_=i(94579),z=i(33535);const D=(0,S.m0)((()=>{const t=(0,O.I0)(),{customizationRefUuids:e=[],itemUuid:i=""}=(0,r.vRw)(),n=(0,z.ZP)();return(0,C.tZ)(s.ZP,{overrides:{PlacementContainer:{style:{zIndex:_.I_.banner}},Root:{style:{marginTop:"32px"}}},children:(0,C.tZ)(h.ZP,{parentContext:"edit",children:(0,C.tZ)(u.Z,{itemUuid:i,onRemoveItem:()=>{t((0,b.im)()),n("eats:remove_item_from_cart_dialog_close")},children:t=>e.length>0?(0,C.tZ)(Z,{store:t.store,initialCustomizations:t.selectedCustomizations,menuItem:t.menuItem,isOnSale:!0,saveCustomizations:t.updateCustomizations,quantity:t.quantity}):(0,C.tZ)(v.ProductDetailsDesktopQuickViewContent,{isEditItemFlow:!0,updateItem:t.updateItem,removeItem:t.removeItem,specialInstructions:t.specialInstructions,updateSpecialInstructions:t.updateSpecialInstructions})})})})}))},94097:(t,e,i)=>{i.d(e,{Z:()=>Q});var s=i(36151),u=i(91631),n=i(62149),o=i(33535),a=i(53614),r=i(50818),c=i(70247),m=i(10208),d=i(47986),l=i(8003),I=i(69694),p=i(58984),U=i(15070),f=i(8420),y=i(87750),C=i(66958),Z=i(79517),h=i(96729),v=i(45106);const b=t=>{const{notifyExternalSyncToCart:e}=(0,h.F)(),i=(0,p.I0)(),b=(0,s.useContext)(a.v),O=(0,o.ZP)(),S=(0,n.TH)(),_=(0,u.k6)(),{serverCart:z,draftOrderUUID:D}=(0,c.Dz)(),[g,q]=(0,s.useState)(!1),P=(0,l.Z)("edit_item_dialog"),k=(0,v.Z)(),A=(0,n.TH)().pathname.includes("/cart"),{mutate:Q}=(0,y.A)("updateItemInDraftOrderV2",D||""),{mutate:R}=(0,y.A)("updateItemInGroupDraftOrderV2",D||""),T=(0,I.Z)(),E=t.menuItem?.data,B=(0,s.useCallback)((()=>{b?_.goBack():_.replace((0,d.Zs0)(S))}),[b,_,S]),w=(0,U.v)((t=>{let{outOfItems:e}=t;return e})),{backupProduct:L}=w,x=(0,s.useCallback)((()=>{const s=t.store?.data;if(!E||!s)return;const u=[{sectionUUID:L?.sectionUUID,subsectionUUID:L?.subsectionUUID,title:L?.title,quantity:t.quantity,storeUUID:s.uuid,skuUUID:L?.itemUUID}],n=(0,m.qH)(t.selectedCustomizations,E.customizationsList)||{};O("eats:update_cart_item",{store:(0,r.TG)(s),quantity:t.quantity,...D?{draftOrderUuid:D}:{}});const{isPricedByWeight:o,isSoldByWeight:a,soldByUnit:c}=(0,C.ap)(E),d={uuid:E.uuid,shoppingCartItemUuid:t.cartItemUuid,storeUuid:s.uuid,sectionUuid:E.sectionUuid,subsectionUuid:E.subsectionUuid,price:E.price,title:E.title,quantity:t.quantity,customizations:n,specialInstructions:t.specialInstructions,imageURL:E.imageUrl,fulfillmentIssueAction:s.fulfillmentIssueOptions&&t.outOfItemAction?{type:t.outOfItemAction,itemSubstitutes:"SUBSTITUTE_ITEM"===t.outOfItemAction?u:[]}:{}};if(o&&t.decimalQuantity&&(d.itemQuantity={inSellableUnit:{value:Z.Tf.from(t.decimalQuantity).toE5().toCoefficientDecimal(),measurementUnit:c}},d.pricedByUnit=E?.purchaseInfo?.pricingInfo?.pricedByUnit,d.quantity=a?1:d.quantity,d?.fulfillmentIssueAction?.itemSubstitutes?.[0]&&(d.fulfillmentIssueAction.itemSubstitutes[0].itemQuantity=d.itemQuantity,d.fulfillmentIssueAction.itemSubstitutes[0].quantity=d.quantity)),T){q(!0);(T.isGroupOrder?R:Q)({draftOrderUUID:D,cartUUID:T.cartUUID,item:d}).then((()=>{e({cartId:T.draftOrderUUID??"",storeId:s.uuid}),i((0,f.im)())}))}}),[t.store?.data,t.quantity,t.selectedCustomizations,t.cartItemUuid,t.specialInstructions,t.outOfItemAction,t.decimalQuantity,E,L?.sectionUUID,L?.subsectionUUID,L?.title,L?.itemUUID,O,D,T,R,Q,i,e]),F=(0,s.useCallback)((function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];P({shoppingCartItemUUIDs:[t.cartItemUuid]}),e&&1===z.data?.items.length&&(k||A)?O("eats:remove_item_from_cart_dialog_close"):t.onRemoveItem()}),[P,t,z.data?.items.length,k,A,O]);return(0,s.useEffect)((()=>{!z.isLoading&&z.hasLoaded&&g&&B()}),[g,z,B]),t.children({updateItem:x,removeItem:F})};var O=i(31139),S=i(78665),_=i(1795),z=i(64388),D=i(31755),g=i(47857),q=i(98976),P=i(49723),k=i(33990);const A=t=>{let{cartItem:e,store:i,menuItem:u,onRemoveItem:n,children:o}=t;const[a,r]=s.useState(""),{partialMenuItem:c}=(0,D.Z)(i,e?.storeUuid,e?.sectionUuid,e?.subsectionUuid,e?.uuid),{outOfItemAction:m,updateOutOfItemAction:d,backupProduct:l,specialInstructions:I,updateSpecialInstructions:p}=(0,P.Z)(),{quantity:U,decimalQuantity:f,updateQuantity:y,updateCustomizations:C,selectedCustomizations:Z,hasErrors:h,totalPrice:v,firstIncompleteGroup:S,discountedPrice:_}=(0,O.e3)();return(0,k.tZ)(b,{cartItemUuid:e.shoppingCartItemUuid,store:i,menuItem:u,selectedCustomizations:Z,quantity:U,decimalQuantity:f,specialInstructions:I||"",onRemoveItem:n,outOfItemAction:m,children:t=>{let{updateItem:e,removeItem:s}=t;return o({store:i,menuItem:u,partialMenuItem:c,quantity:U,updateQuantity:y,specialInstructions:I,updateSpecialInstructions:p,updateCustomizations:C,selectedCustomizations:Z,hasErrors:h,totalPrice:v,updateItem:e,removeItem:s,firstIncompleteGroup:S,incompleteSubmissionState:a,setIncompleteSubmissionState:t=>r(t),outOfItemAction:m,updateOutOfItemAction:d,backupProduct:l,discountedPrice:_})}})},Q=t=>{const{isLoading:e,cartItem:i}=(0,S.Z)(t.itemUuid),{store:u}=(0,z.ZP)(i?.storeUuid),n=(0,q.hn)((0,g.A)({storeUuid:i?.storeUuid||"",sectionUuid:i?.sectionUuid||"",subsectionUuid:i?.subsectionUuid||"",menuItemUuid:i?.uuid||"",cbType:"EATER_ENDORSED"},{preparedId:"checkout-edit-item-menu-item",queryObserverOptions:{enabled:Boolean(i?.storeUuid&&i.sectionUuid&&i.subsectionUuid&&i.uuid)}})),{specialInstructionsState:o,setInitialSpecialInstructions:a}=(0,P.Z)();return s.useEffect((()=>{!e&&i&&"STALE"===o.status&&a(i.specialInstructions)}),[e]),e?(0,k.tZ)(_.Z,{}):i?(0,k.tZ)(O.ZP,{itemParams:{storeUuid:i.storeUuid,sectionUuid:i.sectionUuid,subsectionUuid:i.subsectionUuid,itemUuid:i.uuid},editItemParams:{initialQuantity:i.quantity,initialDecimalQuantity:Z.Tf.maybeFrom(i.itemQuantity?.inSellableUnit?.value),initialCustomizations:i.customizations,initialSpecialInstructions:i.specialInstructions},children:(0,k.tZ)(A,{cartItem:i,store:u,menuItem:n,onRemoveItem:t.onRemoveItem,children:t.children})}):null}}}]);