(self.webpackChunkFusion=self.webpackChunkFusion||[]).push([[93259],{16771:(e,t,r)=>{"use strict";r.d(t,{M:()=>S,Z:()=>F});var s=r(36151),n=r(91631),o=r(62149),i=r(33535),l=r(47986),u=r(12040),d=r(85191),a=r(99990);const c="sort",p=e=>{let{filterValue:t,sortAndFilters:r,filterIndex:s,option:n}=e;if(-1===s)return[...r,n];if(0===n.options.length)return[...r.filter((e=>e.uuid!==t.uuid))];const o=[...r];return o[s]=n,o},f=e=>e.reduce(((e,t)=>{const{options:r}=t;return r&&(e[t.uuid]=r),e}),{}),h=e=>e&&e.uuid?{[e.uuid]:(e.options||[]).filter((e=>{let{selected:t}=e;return t})).map((e=>{let{uuid:t}=e;return{uuid:t||""}}))}:{},S=e=>{let{sortAndFilters:t,selectedFilter:r}=e;const n=(0,o.TH)(),i=(0,s.useMemo)((()=>(0,l.U8Z)(n.search,["sortAndFilters"])),[n.search]),d=(0,s.useMemo)((()=>(0,u.nL)(i.sortAndFilters)),[i.sortAndFilters]),a=(0,s.useMemo)((()=>((e,t)=>{const r=[];return e.forEach(((e,s)=>{t.find((t=>t.uuid===e.values?.[0]?.uuid))&&r.push(s)})),r})(t||[],d)),[t,d]),c=(0,s.useMemo)((()=>({...f(d),...h(r)})),[d,r]),p=(0,s.useMemo)((()=>((e,t)=>e.map((e=>{const r=e.values?.[0];if(!r)return e;const s=r.uuid||"",n=(r.options||[]).map((e=>{const r=t[s]?.find((t=>t.uuid===e.uuid));return{...e,selected:Boolean(r)||!t[s]&&Boolean(e.selected)}}));return"AISLE_FILTER"===e.tab&&n.sort(((e,t)=>(e.value||"").localeCompare(t.value||""))),{...e,values:[{...r,options:n}]}})))(t||[],c)),[t,c]);return{selectedSortAndFilters:d,selectedFilterIndex:a,sortAndFiltersState:p}},F=e=>{let{sortAndFilters:t,filterUpdateNavigationType:r="PUSH"}=e;const[u,f]=(0,s.useState)(null),h=(0,o.TH)(),F=(0,n.k6)(),y=(0,i.ZP)(),_=(0,i.I0)(),{storeUuid:g}=(0,a.QT)(),{selectedSortAndFilters:m,selectedFilterIndex:A,sortAndFiltersState:Z}=S({sortAndFilters:t,selectedFilter:u}),[b,v]=(0,d.Z)({root:null,rootMargin:"",threshold:0});(0,s.useEffect)((()=>{if(v&&v.isIntersecting){const e="eats:store_search_sort_and_filters_impression";_(e,{storeSearch:{storeUuid:g}},`${e}-${g}`)}}),[_,v,g]);const I=e=>{if(!e)return;const t=m.findIndex((t=>t.uuid===e.uuid));if(u?.type==c){((e,t)=>{const r=e.find((e=>e.values[0].type===c));if(r&&r.values.length>0){const t=r.values[0];if(t.options.length>0&&!0===t.options[0].selected){const t=e.findIndex((e=>e.values[0].type===c));if(-1!=t)return{sortIndex:t}}}return null})(Z)&&(e={...u,options:[]})}const{uuid:s,options:n}=e,o={uuid:s||"",options:(n||[]).map((e=>({uuid:e.uuid||""})))};-1===t&&0===o.options.length||("REPLACE"!==r?F.push((0,l.zSE)(h,p({filterValue:e,sortAndFilters:m,filterIndex:t,option:o}))):F.replace((0,l.zSE)(h,p({filterValue:e,sortAndFilters:m,filterIndex:t,option:o}))))},U=()=>{f(null)};return{selectedFilter:u,selectedSortAndFilters:m,selectedFilterIndex:A,sortAndFiltersState:Z,sortAndFiltersRef:b,handleClose:U,handleOptionSelect:e=>{u&&f({...u,options:(u.options||[]).map((t=>{const r=e.find((e=>e.uuid===t.uuid));return{...t,selected:Boolean(r)}}))})},handleReset:()=>{u&&(y("eats:store_search_sort_and_filters_reset",{storeSearch:{storeUuid:g,sortAndFilters:{uuid:u.uuid,type:u.type}}}),I({...u,options:[]}),U())},handleDone:()=>{if(u){const e=(u.options||[]).filter((e=>e.selected));y("eats:store_search_sort_and_filters_done",{storeSearch:{storeUuid:g,sortAndFilters:{uuid:u.uuid,type:u.type,isSingleOption:!1,selected:e.length>0}}}),I({...u,options:e}),U()}},handleOpen:e=>{u?.uuid===e.uuid?f(null):(y("eats:store_search_sort_and_filters_open",{storeSearch:{storeUuid:g,sortAndFilters:{uuid:e.uuid,type:e.type}}}),f(e))},handleOptionSingleSelect:e=>{const t=-1===m.findIndex((t=>t.uuid===e?.uuid));y("eats:store_search_sort_and_filters_done",{storeSearch:{storeUuid:g,sortAndFilters:{uuid:e.uuid,type:e.type,isSingleOption:!0,selected:t}}}),I({...e,options:t?e.options:[]})}}}},48193:(e,t,r)=>{"use strict";r.d(t,{Z:()=>c});var s=r(26460),n=r(72238),o=r(21322),i=r(89400),l=r(33990);const u=e=>{let{options:t,onSelect:r}=e;const u=t.find((e=>e.selected));return(0,l.tZ)("ul",{children:t.map((e=>(0,l.tZ)(n.Z,{artwork:()=>(0,l.tZ)(s.Z,{checked:e.uuid===u?.uuid,onChange:()=>r([e])}),onClick:()=>r([e]),children:(0,l.tZ)(o.Z,{children:(0,l.tZ)(i.Z,{badge:e.badge,baseFont:"LabelMedium"})})},e.uuid)))})};var d=r(38488);const a=e=>{let{options:t,onSelect:r,minPermitted:s,maxPermitted:i}=e;const u=t.filter((e=>e.selected)),a=u.length,c=e=>{const t=u.some((t=>t.uuid===e.uuid)),n=u.filter((t=>t.uuid!==e.uuid));return!t&&a<i?r([...n,e]):t&&a>s?r([...n]):void 0};return(0,l.tZ)("ul",{children:t.map((e=>(0,l.tZ)(n.Z,{onClick:()=>c(e),artwork:()=>(0,l.tZ)(d.Z,{checked:Boolean(e.selected),onChange:()=>c(e)}),children:(0,l.tZ)(o.Z,{children:e.value})},e.uuid)))})},c=e=>{let{type:t,options:r,maxPermitted:s,minPermitted:n,onSelect:o}=e;switch(t){case"sort":return(0,l.tZ)(u,{options:r,onSelect:o});case"aisleFilter":case"brandFilter":return(0,l.tZ)(a,{options:r,maxPermitted:s,minPermitted:n,onSelect:o});default:return null}}},41218:(e,t,r)=>{"use strict";r.d(t,{Z:()=>g});var s=r(36151),n=r(92300),o=r(32857),i=r("__fusion__954"),l=r("__fusion__1404"),u=r("__fusion__1642"),d=r("__fusion__677"),a=r(54840),c=r(89400),p=r(33990);const f=e=>{let{selectedSortAndFilters:t,options:r,uuid:s,badge:n,isSelected:o}=e;const i=t.find((e=>e.uuid===s))?.options?.[0]?.uuid,l=r.find((e=>e.uuid===i));return(0,p.tZ)(c.Z,{badge:l?l.badge:n,baseFont:"LabelSmall",baseColor:o?"contentInversePrimary":"contentPrimary"})},h={[a.GZ]:u.default,[a.Vz]:l.default},S={[a.GZ]:i.default,[a.Vz]:l.default},F={[a._l]:f},y={[a._l]:"store-search-sort-by-pill",aisleFilter:"store-search-aisle-pill",brandFilter:"store-search-brand-pill",[a.GZ]:"store-search-deals-pill"},_=(0,s.forwardRef)(((e,t)=>{let{filterValue:r,selectedSortAndFilters:i,onOpen:l,onOptionSingleSelect:u,...a}=e;const{uuid:f,type:_,options:g}=r,m=(0,s.useMemo)((()=>(i.find((e=>e.uuid===f))?.options||[]).length),[f,i]);if(!g||!g?.length)return null;const A=g.length>1,Z=A?r.badge:g[0]?.badge||r.badge,b=(_||"")in h?()=>{const e=((e,t)=>t&&e in S?S[e]:e in h?h[e]:null)(_,a.isSelected);return(0,p.tZ)(e,{})}:null,v=A?()=>(0,p.tZ)(d.default,{}):void 0,I=_?F[_]:null;return(0,p.tZ)(o.Z,{ref:t,startEnhancer:b,endEnhancer:v,...a,onClick:()=>{A?l(r):u(r)},"data-testid":y[_||""],overrides:(0,n.aO)(a.overrides,{BaseButton:{style:e=>{let{$theme:t}=e;return{whiteSpace:"nowrap"}}}}),children:I?(0,p.tZ)(I,{selectedSortAndFilters:i,options:g,uuid:f,badge:Z,isSelected:a.isSelected}):(0,p.BX)(p.HY,{children:[(0,p.tZ)(c.Z,{badge:Z,baseFont:"LabelSmall",baseColor:a.isSelected?"contentInversePrimary":"contentPrimary"}),A&&m?(0,p.BX)(p.HY,{children:["Â ",`(${m})`]}):null]})})}));_.displayName="StoreSearchSharedFilterPill";const g=_},96520:(e,t,r)=>{"use strict";r.d(t,{Z:()=>c});var s=r(36151),n=r(55758),o=r(7221),i=r(74622),l=r(2237),u=r(62459);var d=r(90075),a=r(16771);function c(e){let{storeUuid:t,sectionUuid:r,storeSearchQuery:c,isGrocery:p,targetLocation:f}=e;const h=(0,s.useRef)(null),[S,F]=(0,s.useState)(null),y=(0,n.d)(),_=(0,d.Z)(),{isSortAndFilterApplied:g,sortAndFiltersApplied:m}=(e=>{let{sortAndFilters:t}=e;const{selectedSortAndFilters:r,sortAndFiltersState:n}=(0,a.M)({sortAndFilters:t,selectedFilter:null}),o=(0,s.useMemo)((()=>n.map((e=>{const t=e.values?.[0];if(!t)return;const r=t.options?.filter((e=>e.selected));return r&&0!==r.length?{...t,options:r}:void 0})).filter(Boolean)),[n]);return{isSortAndFilterApplied:r.length>0,sortAndFiltersApplied:o}})({sortAndFilters:S}),A=function(e,t){const r=(0,u.Z)("getInStoreItemsByUserQueryV1"),s={queryKey:(0,l.H)("getInStoreItemsByUserQueryV1",e),queryFn:e=>{let{queryKey:t}=e;return r.request("getInStoreItemsByUserQueryV1",t[1])}};return t&&t.queryObserverOptions&&Object.assign(s,t.queryObserverOptions),(0,i.useQuery)(s)}({diningMode:y,sectionUUIDs:r&&!p?[r]:null,storeUUIDs:[t],userQuery:c,isGrocery:p,targetLocation:f},{queryObserverOptions:{enabled:Boolean(c)&&!_}}),Z=(0,o.u)({diningMode:y,sectionUUIDs:r&&!p?[r]:null,storeUUIDs:[t],userQuery:c,isGrocery:p,targetLocation:f,entrypointContext:"IN_STORE_SEARCH",...g?{sortAndFilters:m}:null},{queryObserverOptions:{enabled:Boolean(c)&&_}}),{error:b,isLoading:v,isSuccess:I,isError:U}=_?Z:A,O=Boolean(S),B=Boolean(I||U),x=(0,s.useMemo)((()=>({data:_?Z.data?.catalogSectionsMap:A.data,isLoading:_?v||!O:v,error:b,isFetched:_?B&&O:B})),[b,O,A.data,Z.data,B,v,_]),M=_&&Z.data?.sortAndFilters||null;return(0,s.useEffect)((()=>{!_||!I||O&&c===h.current||(h.current=c,F(M||[]))}),[_,I,O,M,c]),{catalogSections:x,sortAndFilters:S}}},90075:(e,t,r)=>{"use strict";r.d(t,{Z:()=>o});var s=r(60849),n=r(41063);const o=()=>{const e={...n.v.in_store_search_sort_and_filters,defaultValue:!1};return(0,s.ip)(e)}},7221:(e,t,r)=>{"use strict";r.d(t,{u:()=>i});var s=r(74622),n=r(2237),o=r(62459);function i(e,t){const r=(0,o.Z)("getInStoreSearchV1"),i=(0,n.H)("getInStoreSearchV1",e);return(0,s.useQuery)({queryKey:i,queryFn:e=>{let{queryKey:t}=e;return r.request("getInStoreSearchV1",t[1])},...t?.queryObserverOptions})}},44764:(e,t,r)=>{e.exports=r.p+"f601b8be1064c30a.svg"}}]);