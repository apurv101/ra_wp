"use strict";(self.webpackChunkFusion=self.webpackChunkFusion||[]).push([[31139],{30137:(t,e,a)=>{a.d(e,{Z:()=>c});var r=a(36151),i=a(91631),n=a(47986),s=a(62149),o=a(89917),d=a(60743),u=a(95461);function c(){const t=(0,s.TH)(),e=(0,i.k6)(),{totalOrders:a}=(0,d.Z)(),c=(0,o.Z)(),l=(0,u.Z)();return(0,r.useCallback)((r=>{const{modalName:i,entryPoint:s}=(0,n.RAN)(t,["modalName","entryPoint"]);if(l&&"full-page-multicart-switcher"===s)c({type:"MODAL_CLOSE"});else if("editItem"===i&&r)l&&e.length>2?e.go(-2):e.replace(r);else if(2===a)e.goBack();else if(a>2){const a=t?.state?.clearLocation;a?e.replace((0,n.vN_)(a,"multicartMobileSwitcher")):e.goBack()}}),[a,e,t,c,l])}},8003:(t,e,a)=>{a.d(e,{Z:()=>b});var r=a(36151),i=a(33535),n=a(50818),s=a(70247),o=a(64388),d=a(69694),u=a(76150),c=a(91631),l=a(45106),m=a(79851),p=a(48566),I=a(47986),U=a(6703),f=a(58984),O=a(54146),D=a(87750),S=a(62149),h=a(47885),v=a(96729),C=a(72179),y=a(30137),P=a(47667),T=a(95461);function b(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"cart";const{notifyExternalSyncToCart:e,notifyDiscardedOrder:a}=(0,v.F)(),b=(0,S.TH)(),g=(0,c.k6)(),E=(0,l.Z)(),_=(0,m.Z)(),k=(0,i.ZP)(),Z=(0,f.I0)(),A=(0,O.Z)(),B=(0,y.Z)(),L=(0,P.Z)(),w=(0,T.Z)(),{isCartDrafting:Q}=(0,C.Z)(),{draftOrderUUID:M,serverCart:N,isBundledOrder:G,isGroupOrderParticipant:x,isEditOrder:V}=(0,s.Dz)(),z=(0,d.Z)(),{closeSidebarCart:F}=(0,u.Lb)(),{isStorePrecheckoutBundlingEnabled:R}=(0,h.Z)(),{store:q}=(0,o.ZP)(N.data?.storeUuid),H=q.data,{mutate:$}=(0,D.A)("removeItemsFromDraftOrderV2",M||""),{mutate:Y}=(0,D.A)("removeItemsFromGroupDraftOrderV2",M||""),W=(0,p.Z)("remove_all_items");return(0,r.useCallback)((async(r,i)=>{let{shoppingCartItemUUIDs:s}=r;if(H&&(k("eats:remove_from_cart_action_start",{store:(0,n.TG)(H),draftOrderUuid:M||"",isGroupOrderParticipant:x,isEditScheduledOrder:V,source:t}),s.forEach((e=>{const a=(N.data?.items||[]).find((t=>t.shoppingCartItemUuid===e));k("eats:remove_from_cart",{store:(0,n.TG)(H),cartItem:a,draftOrderUuid:M||"",isGroupOrderParticipant:x,isEditScheduledOrder:V,source:t,isDrafting:Q})})),z?.cartUUID))if(z.isGroupOrder)await Y({cartUUID:z.cartUUID,draftOrderUUID:z.draftOrderUUID,shoppingCartItemUUIDs:s,storeUUID:z.storeUUID}),e({cartId:z.draftOrderUUID??"",storeId:H.uuid});else if(N.data?.items.length===s.length){if(V)return F(),Z((0,U.$R)(z.storeUUID||"",N.data?.items[0]?.uuid||"",N.data?.items[0]?.quantity||1)),void g.push((0,I.Tfj)(b));if(R&&G)g.push((0,I.vN_)(b,"bundledOrderDiscard",{draftOrderUUID:M}));else{F(),await W(),a({storeId:z.storeUUID??""});const t=(0,I.gfM)(b,(0,I.Btk)(H));if(E){if(A)return void g.replace(t);g.replace(_)}else(L||w)&&(i?.isQuickAdd||B(t))}}else await $({cartUUID:z.cartUUID,draftOrderUUID:z.draftOrderUUID,shoppingCartItemUUIDs:s,storeUUID:z.storeUUID,actionMeta:i}),e({cartId:z.draftOrderUUID??"",storeId:H.uuid})}),[H,z,N.data?.items,k,M,W,E,w,g,_,I.Btk,b,I.gfM,A,$,Y,x,t])}},33967:(t,e,a)=>{a.d(e,{Z:()=>g});var r=a(43193),i=a(76150),n=a(33535),s=a(92431),o=a(87696),d=a(70247),u=a(83960),c=a(50818),l=a(69694),m=a(45106),p=a(8003),I=a(88671),U=a(64388),f=a(58984),O=a(6703),D=a(79517),S=a(66958),h=a(87750),v=a(61304),C=a(12545),y=a(96729),P=a(73472),T=a(65014),b=a(49723);function g(t,e,a){const{notifyExternalSyncToCart:g}=(0,y.F)(),{closeSidebarCart:E}=(0,i.Lb)(),_=(0,n.ZP)(),k=(0,s.Z)(),Z=(0,o.Ah)(k),{serverCart:A}=(0,d.iQ)(),{store:B}=(0,U.ZP)(A.data?.storeUuid),{mutate:L}=(0,h.A)("updateItemInDraftOrderV2",Z||""),{mutate:w}=(0,h.A)("updateItemInGroupDraftOrderV2",Z||""),Q=(0,l.Z)(),{hasGroupOrder:M,isEditOrder:N,isDraftOrderParticipant:G}=(0,u.Z)(),x=(0,m.Z)(),V=(0,p.Z)(),z=(0,f.I0)(),F=r.useRef(!1),R=(0,I.k)(),{stopTiming:q}=(0,P.K3)(),{outOfItemAction:H,backupProduct:$}=(0,b.Z)();r.useEffect((()=>{0!==A.data?.items.length||M||E(),!A.isLoading&&A.hasLoaded&&(A.error&&F.current&&!x?(R(!1,A.error,!1,B),F.current=!1):e&&F.current&&!x&&(F.current=!1,R(!1,null,!1,B,!0)))}));const Y=r.useCallback((async(t,e,r,i,n)=>{const{data:s}=B;if(!s||!t)return;const o=a&&s.fulfillmentIssueOptions&&H,d=o&&"SUBSTITUTE_ITEM"===H&&$?[{sectionUUID:$.sectionUUID,subsectionUUID:$.subsectionUUID,title:$.title,quantity:e,storeUUID:s.uuid,skuUUID:$.itemUUID}]:null,u={...t,quantity:e,...o?{fulfillmentIssueAction:{type:H,itemSubstitutes:d}}:null},{pricedByUnit:l,soldByUnit:m,soldByWeight:p}=(0,S.n$)(u),I={prevQuantity:t.quantity,quantity:e,store:(0,c.TG)(s),isGroupOrderParticipant:G,isEditScheduledOrder:N,...l&&{pricedByUnit:l},...m&&{soldByUnit:m},...t?{cartItem:t}:{},...Z?{draftOrderUuid:Z}:{}};_("eats:update_cart_item_quantity",I),u?.itemQuantity?.inSellableUnit&&(i||(i=D.Tf.from(u.quantity).toBaseDecimal()),u.quantity=p?1:D.Tf.from(i).toInt(),u.itemQuantity.inSellableUnit.value={coefficient:i.base,exponent:i.exponent});const U=n===v.b.STOREFRONT&&r?.isQuickAdd?{draftOrderPresentationSourceType:C.lB.QUICK_ADD_STOREFRONT}:void 0;F.current=!0,Q&&Q.cartUUID&&(Q.isGroupOrder?await w({draftOrderUUID:Q.draftOrderUUID,cartUUID:Q.cartUUID,item:u}):await L({draftOrderUUID:Q.draftOrderUUID,cartUUID:Q.cartUUID,item:u,actionMeta:r,...U&&{draftOrderPresentationContext:U}}),q(`${T.B.UPDATE_ITEM_QUANTITY}_${u.uuid||""}`,{shouldEmitTiming:!0,overrideLabelFn:()=>T.B.UPDATE_ITEM_QUANTITY}),q(`${T.B.UPDATE_ITEM_QUANTITY_WITH_DEBOUNCE}_${u.uuid||""}`,{shouldEmitTiming:!0,overrideLabelFn:()=>T.B.UPDATE_ITEM_QUANTITY_WITH_DEBOUNCE}),g({cartId:Q.draftOrderUUID??"",storeId:s.uuid}))}),[B,a,H,$,G,N,Z,_,Q,q,g,w,L]);return r.useCallback(((e,a,r,i)=>{const n=(A.data?.items||[]).find((t=>t.shoppingCartItemUuid===e));n&&!t&&z((0,O.AA)(n.uuid)),a?"number"==typeof a?Y(n,a,r,null,i):Y(n,a.base/Math.pow(10,Math.abs(a.exponent)),r,a,i):V({shoppingCartItemUUIDs:[e]},r)}),[t,z,V,A.data,Y])}},31139:(t,e,a)=>{a.d(e,{ZP:()=>T,e3:()=>P});var r=a(36151),i=a(91631),n=a(47986),s=a(69744),o=a(54510),d=a(46668),u=a(76594),c=a(79517),l=a(62155),m=a(43193),p=a(87444);const I=t=>{const e=(0,p.Z)("item_variants"),{menuItem:a}=t,[r,i]=m.useState(t),n=r.menuItem.data||a.data,s=null!==(0,l.Ju)(n?.productDetailsItems??[]);e&&a.hasLoaded&&a.data?.uuid!==r.menuItem.data?.uuid&&s&&i(t);const o=!a.hasLoaded&&r?.menuItem.hasLoaded&&s;return e?{hasVariantOptions:s,isSwitchingVariantOptions:o,values:o?r:t}:{hasVariantOptions:!1,isSwitchingVariantOptions:!1,values:t}};var U=a(54669),f=a(62149),O=a(60849),D=a(41063),S=a(33967),h=a(33990);const v={...d.E},C={...d.E},y=r.createContext({isCanonicalProduct:!1,isSwitchingStores:!1,isSwitchingVariantOptions:!1,canonicalItemStoreUuid:null,setCanonicalItemStoreUuid:s.Z,isUnavailableNearby:!1,productUuid:null,menuItem:v,hasVariantOptions:!1,quantity:1,partialMenuItem:null,store:C,updateQuantity:(t,e)=>{},specialInstructions:"",updateSpecialInstructions:t=>{},updateCustomizations:t=>{},selectedCustomizations:{},hasErrors:!1,isOnSale:!0,totalPrice:0,discountedPrice:0,addToCart:t=>{let{isStartingNewOrder:e,eventSource:a}=t},isDeliveryLocationSet:!0,setDeliveryLocation:t=>{},firstIncompleteGroup:"",incompleteSubmissionState:"",setIncompleteSubmissionState:t=>{},outOfItemAction:null,updateOutOfItemAction:t=>{},updateUpsellItemQuantity:(t,e)=>{},itemsUpsell:u.E,spendingLimitError:null,canEditGroupOrderCart:!1,showClosedRestaurantUX:!1,storeUnavailableMessage:"",backupProduct:null,updateBackupProduct:t=>{},decimalQuantity:c.Tf.from(1).toBaseDecimal(),didAddItem:!1,isDraftOrderParticipantForStore:!1,itemParams:void 0,selectedSavedCustomizationIndex:-1,setSelectedSavedCustomizationIndex:t=>{},numClicks:0,editItemParams:null,updateItemQuantity:()=>{}});function P(){const t=r.useContext(y);if(null!==t)return t;throw Error("You should use useProductDetailsContext only in a descendant of ProductDetailsProvider")}const T=function(t){let{children:e,navigateBackOnItemAdd:a=!1,itemParams:s,editItemParams:d,shoppingCartItemUuid:u}=t;const c=(0,U.Z)(),[m,v]=r.useState(null),[C,P]=r.useState(null),T=(0,i.UO)(),{productUuid:b}=(0,n.hNc)(T),g=(0,f.TH)(),E=(0,O.ip)({...D.v.eats_web_store_shopping_list,defaultValue:!1}),{entryPoint:_}=(0,n.RAN)(g,["entryPoint"]),k=Boolean(b),Z=r.useRef(0),A=r.useCallback((()=>{Z.current=Z.current+1}),[]),B=(0,o.Z)({shouldNavigateBackToStoreOnItemAdd:E&&"shoppingList"===_||a,canonicalItemStoreUuid:m,productUuid:b,itemParams:s,editItemParams:d,preparedId:"store-product-details-provider"}),L=(0,p.Z)("pdp_click_tracking_enabled");r.useEffect((()=>(L&&document.addEventListener("mousedown",A),()=>{L&&document.removeEventListener("mousedown",A)})),[L,A]);const{hasVariantOptions:w,isSwitchingVariantOptions:Q,values:{partialMenuItem:M,store:N,menuItem:G,quantity:x,updateQuantity:V,specialInstructions:z,updateSpecialInstructions:F,updateCustomizations:R,selectedCustomizations:q,hasErrors:H,isOnSale:$,totalPrice:Y,discountedPrice:W,addToCart:X,isDeliveryLocationSet:K,setDeliveryLocation:j,firstIncompleteGroup:J,incompleteSubmissionState:tt,setIncompleteSubmissionState:et,outOfItemAction:at,updateOutOfItemAction:rt,updateUpsellItemQuantity:it,itemsUpsell:nt,spendingLimitError:st,canEditGroupOrderCart:ot,showClosedRestaurantUX:dt,storeUnavailableMessage:ut,backupProduct:ct,updateBackupProduct:lt,decimalQuantity:mt,didAddItem:pt,isDraftOrderParticipantForStore:It,selectedSavedCustomizationIndex:Ut,setSelectedSavedCustomizationIndex:ft}}=I(B);if(k&&G.hasLoaded&&G.data){const t=(0,l.vu)(G.data.productDetailsItems)?.defaultSelectedStoreUuid;C!==c&&t!==m&&(v(t),P(c)),m||!t||Q||v(t)}const Ot=k&&K&&!m&&!Q,Dt=(0,S.Z)(!1,!0,!0),St=r.useCallback((()=>{u&&Dt(u,x)}),[u,x,Dt]);return(0,h.tZ)(y.Provider,{value:{isCanonicalProduct:k,isSwitchingStores:!N.hasLoaded,canonicalItemStoreUuid:m,setCanonicalItemStoreUuid:v,isSwitchingVariantOptions:Q,isUnavailableNearby:Ot,productUuid:b,menuItem:G,hasVariantOptions:w,quantity:x,partialMenuItem:M,store:N,updateQuantity:V,specialInstructions:z,updateSpecialInstructions:F,updateCustomizations:R,selectedCustomizations:q,hasErrors:H,isOnSale:$,totalPrice:Y,discountedPrice:W,addToCart:X,isDeliveryLocationSet:K,setDeliveryLocation:j,firstIncompleteGroup:J,incompleteSubmissionState:tt,setIncompleteSubmissionState:et,outOfItemAction:at,updateOutOfItemAction:rt,updateUpsellItemQuantity:it,itemsUpsell:nt,spendingLimitError:st,canEditGroupOrderCart:ot,showClosedRestaurantUX:dt,storeUnavailableMessage:ut,backupProduct:ct,updateBackupProduct:lt,decimalQuantity:mt,didAddItem:pt,isDraftOrderParticipantForStore:It,itemParams:s,selectedSavedCustomizationIndex:Ut,setSelectedSavedCustomizationIndex:ft,numClicks:Z.current,editItemParams:d,updateItemQuantity:St},children:e})}},45106:(t,e,a)=>{a.d(e,{Z:()=>i});var r=a(62149);function i(){return(0,r.TH)().pathname.includes("/checkout")}}}]);